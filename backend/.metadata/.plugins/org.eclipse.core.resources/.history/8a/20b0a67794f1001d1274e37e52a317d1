package com.cg.upload.serviceimpl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import com.cg.upload.dto.UploadInfo;
import com.cg.upload.entity.Upload;
import com.cg.upload.repository.UploadRepo;
import com.cg.upload.service.UploadService;
import com.cg.upload.util.UploadUtil;

@Service
public class UploadServiceImpl implements UploadService {

	@Autowired
	private UploadUtil uploadUtil;
	@Autowired
	private UploadRepo repo;

	@Override
	public UploadInfo upload(String ownerId, MultipartFile[] files) {
		UploadInfo info = new UploadInfo();
		info.setOwnerId(ownerId);

		for (MultipartFile file : files) {
			StringBuilder path = new StringBuilder("http://localhost:8004");
			path.append(uploadUtil.prepareImage(file, ownerId));			
			String fileName = path.substring(path.lastIndexOf("/"));
			info.getUrls().add(path.toString());
			
			Upload upload = new Upload();
			upload.setFileName(fileName);
			upload.setOwnerId(ownerId);
			upload.setPath(path.toString());
	
			repo.save(upload);
		}
	
		return info;
	}

	@Override
	public Object remove(String fileName) {
		return uploadUtil.deleteImage(fileName);
	}

	@Override
	public Object removeAllByOwner(String ownerId) {
		// delete from db
		return uploadUtil.deleteDirectory(ownerId);
	}

	@Override
	public Object get(String ownerId) {
		// get from db
		return null;
	}

	@Override
	public Object getFile(String fileName) {
		return null;
	}

}
